create database EzManage
GO

use EzManage
GO

set dateformat DMY
GO

DROP TABLE dbo.MATKHAUNV

CREATE TABLE MATKHAUNV
(
	USERNAME VARCHAR(100) PRIMARY KEY,
	PASS VARCHAR(20),
	ACCESSLEVEL INT
)
GO
INSERT INTO MATKHAUNV VALUES ('HOANGVINH','1','1','123')
insert into matkhaunv values ('hoangvinh02','1','0','1234')
SELECT * FROM MATKHAUNV
CREATE TABLE NHANVIEN -- BẢNG NHÂN VIÊN ĐỂ LƯU THÔNG TIN NHÂN VIÊN
(
	TENNV NVARCHAR(50),
	MANV VARCHAR(20) PRIMARY KEY,
	NGAYSINH SMALLDATETIME,
	NGAYVAOLAM SMALLDATETIME,
	LUONG MONEY,
	NGAYCONG INT
)

GO

ALTER TABLE dbo.MATKHAUNV ADD USERID VARCHAR(20) -- THÊM ĐỂ TÌM THÔNG TIN NHÂN VIÊN VÀ XUẤT RA FORM KHI NHÂN VIÊN ĐĂNG NHẬP
GO

ALTER TABLE dbo.MATKHAUNV ADD CONSTRAINT USERID FOREIGN KEY REFERENCES dbo.NHANVIEN(MANV) -- KHOÁ NGOẠI ĐỂ TÌM NHÂN VIÊN KHI  NHÂN VIÊN ĐĂNG NHẬP VÀ ĐỂ THÔNG TIN TRÊN FORM

-- ALTER TABLE dbo.MATKHAUNV DROP COLUMN USERID

--INSERT INTO dbo.MATKHAUNV
--(
--    USERNAME,
--    PASS,
--    ACCESSLEVEL
--)
--VALUES
--(   'user', -- USERNAME - varchar(100)
--    '1', -- PASS - varchar(20)
--    0   -- ACCESSLEVEL - int
--    )
--GO

--INSERT INTO dbo.MATKHAUNV
--(
--    USERNAME,
--    PASS,
--    ACCESSLEVEL
--)
--VALUES
--(   'user1', -- USERNAME - varchar(100)
--    '1', -- PASS - varchar(20)
--    0   -- ACCESSLEVEL - int
--    )
--GO

--INSERT INTO dbo.MATKHAUNV
--(
--    USERNAME,
--    PASS,
--    ACCESSLEVEL
--)
--VALUES
--(   'admin', -- USERNAME - varchar(100)
--    '1', -- PASS - varchar(20)
--    1   -- ACCESSLEVEL - int
--    )
--GO

--INSERT INTO dbo.MATKHAUNV
--(
--    USERNAME,
--    PASS,
--    ACCESSLEVEL
--)
--VALUES
--(   'admin1', -- USERNAME - varchar(100)
--    '1', -- PASS - varchar(20)
--    1   -- ACCESSLEVEL - int
--    )
--GO

SELECT * FROM dbo.MATKHAUNV

CREATE TABLE SACH -- Table lưu trữ thông tin những cuốn sách
(
MASACH varchar(50) PRIMARY KEY NOT NULL,
TENSACH nvarchar(100) NOT NULL,
TENTG nvarchar(100) NOT NULL,
DICHGIA NVARCHAR(50),
NGAYXB date NOT NULL,
LANTAIBAN INT NOT NULL,
GIA int NOT NULL,
THELOAI nvarchar(100) NOT NULL,
-- GHICHU nvarchar(100) NOT NULL
)
SET DATEFORMAT DMY
GO
/*DATA CHO BẢNG SÁCH*/ 
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('ESDCCM01',N'EM SẼ ĐẾN CÙNG CƠN MƯA','ICHIKAWA TAKUJI',N'MẠC TÚ ANH','23-01-2013',1,'50000',N'VĂN HỌC NƯỚC NGOÀI','ESDCCM')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('NGNA01',N'NẾU GẶP NGƯỜI ẤY CHO TÔI GỬI LỜI CHÀO','ICHIKAWA TAKUJI',N'MẠC TÚ ANH','01-06-2018',2,'45000',N'VĂN HỌC NƯỚC NGOÀI','NGNA')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('MAZE01',N'GIẢI MÃ MÊ CUNG','JAMES DASHNER',N'KHÔNG CÓ','01-06-2016',1,'80000',N'VĂN HỌC NƯỚC NGOÀI','MAZE')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('FIRE02',N'THỬ NGHIỆM ĐẤT CHÁY','JAMES DASHNER',N'KHÔNG CÓ','12-06-2017',2,'75000',N'VĂN HỌC NƯỚC NGOÀI','FIRE')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('PERF01',N'TRẠI TRẺ ĐẶC BIỆT CỦA CÔ PEREGRINE','RANSOM RIGGS',N'NHƯ HIẾU','04-05-2015',3,'89000',N'VĂN HỌC NƯỚC NGOÀI','PERF')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('TPHR02',N'THÀNH PHỐ HỒN RỖNG','RANSOM RIGGS',N'KHÔNG CÓ','16-04-2016',1,'90000',N'VĂN HỌC NƯỚC NGOÀI','TPHR')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('TDCD01',N'TÔI ĐI CODE DẠO',N'PHẠM HUY HOÀNG',N'TRUNG HIẾU','03-01-2017',2,'100000',N'SÁCH KHOA HỌC- KỸ THUẬT','TDCD')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('VBTN01',N'VỀ BẢN TÍNH NGƯỜI','EDWARD O.WILSON',N'PHI ÂN','13-12-2014',2,'750000',N'SÁCH KHOA HỌC- KỸ THUẬT','VBTN')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('DAVINCI01',N'MẬT MÃ DANVINCI','DAN BROWN',N'HOÀNG VINH','21-01-2013',1,'150000',N'SÁCH TRINH THÁM','DAVINCI')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('HOANGUC01',N'HỎA NGỤC','DAN BROWN',N'HOÀNG VINH','22-06-2016',2,'200000',N'SÁCH VĂN HỌC NƯỚC NGOÀI','HOANGUC')
INSERT INTO SACH  (MASACH, TENSACH, TENTG, DICHGIA, NGAYXB, LANTAIBAN, GIA, THELOAI,MATUASACH) VALUES ('TMNVB01',N'THEO MỘT NGƯỜI VỀ BIỂN',N'NGUYỄN MỸ NỮ',N'KHÔNG CÓ','31-01-2017',1,'50000',N'SÁCH VĂN HỌC VIỆT NAM','TMNVB')
--TEST BẢNG SÁCH VÀ KHO SÁCH CÓ LIÊN KẾT VỚI NHAU--
SELECT * FROM SACH,KHOSACH
WHERE SACH.MATUASACH= KHOSACH.MATUASACH
DELETE FROM SACH
--TBALE QUẢN LÝ KHO SÁCH --
CREATE TABLE KHOSACH 
(
MATUASACH varchar(50) PRIMARY KEY NOT NULL,
-- TENSACH nvarchar(100) NOT NULL,
SOLUONGMOI int NOT NULL,
NGAYNHAP DATE NOT NULL,
MALOHANG NVARCHAR(20),
TONGSOLUONG INT,
SOLUONGTONKHO INT
-- GHICHU nvarchar(100) NOT NULL
)
--DATA KHO SÁCH--
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('ESDCCM',50,'24/01/2018','IMPORT01',100,50)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('NGNA',60,'24/01/2018','IMPORT01',120,60) 
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('MAZE',70,'24/01/2018','IMPORT01',90,20)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('FIRE',45,'24/01/2018','IMPORT01',155,110)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('PERF',55,'24/01/2018','IMPORT01',115,60)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('TPHR',73,'24/01/2018','IMPORT01',123,50)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('TDCD',65,'24/01/2018','IMPORT01',150,90)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('VBTN',88,'24/01/2018','IMPORT01',188,100)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('DAVINCI',29,'24/01/2018','IMPORT01',119,90)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('HOANGUC',56,'24/01/2018','IMPORT01',186,100)
INSERT INTO KHOSACH (MATUASACH, SOLUONGMOI, NGAYNHAP, MALOHANG, TONGSOLUONG, SOLUONGTONKHO) VALUES ('TMNVB',110,'24/01/2018','IMPORT01',190,80)
SELECT * FROM KHOSACH
GO
--CREATE TABLE BUTBI
--(
--	THELOAI NVARCHAR(100),
--	GIA MONEY,
--	NGAYSANXUAT DATETIME,
--	HANSUDUNG DATETIME,
--	MASANPHAM VARCHAR(50) PRIMARY KEY,
--	NHASANXUAT NVARCHAR(100),
--	MAVACHSANPHAM VARCHAR(20),
--	MALOHANG VARCHAR(30),
--	MAUMUC NVARCHAR(10)
--)
--GO

CREATE TABLE VANPHONGPHAM -- Table quản lý bút
(   
	TENSANPHAM NVARCHAR(20),
	MALOAISANPHAM VARCHAR(20) NOT NULL,
	DANHMUC NVARCHAR(100),
	GIA MONEY,
	NGAYSANXUAT DATETIME,
	HANSUDUNG DATETIME,
	NHASANXUAT NVARCHAR(100),
	MAVACHSANPHAM VARCHAR(20),
)
ALTER TABLE VANPHONGPHAM DROP COLUMN MAVACHSANPHAM
ALTER TABLE VANPHONGPHAM ADD CONSTRAINT FK_KHOVANPHONGPHAM_MALOAISANPHAM FOREIGN KEY (MALOAISANPHAM) REFERENCES KHOVANPHONGPHAM (MALOAISANPHAM)
ALTER TABLE VANPHONGPHAM DROP CONSTRAINT FK_KHOVANPHONGPHAM_MALOAISANPHAM
ALTER TABLE VANPHONGPHAM ADD TENSANPHAM NVARCHAR(50)
--TEST 2 BẢNG VĂN PHÒNG PHẨM VÀ KHO VĂN PHÒNG PHẨM CÓ LIÊN KẾT VỚI NHAU--
SELECT * FROM VANPHONGPHAM,KHOVANPHONGPHAM
WHERE VANPHONGPHAM.MALOAISANPHAM= KHOVANPHONGPHAM.MALOAISANPHAM
--DATA CHO BẢNG VĂN PHÒNG PHẨM
INSERT INTO VANPHONGPHAM (MASANPHAM, TENSANPHAM, MALOAISANPHAM, GIA, DANHMUC, NGAYSANXUAT, HANSUDUNG, NHASANXUAT) VALUES ('TL01_01',N'BÚT BI XANH THIÊN LONG','TL01',3000,N'BÚT BI','14/06/2019','14/06/2021','THIÊN LONG')
INSERT INTO VANPHONGPHAM (MASANPHAM, TENSANPHAM, MALOAISANPHAM, GIA, DANHMUC, NGAYSANXUAT, HANSUDUNG, NHASANXUAT) VALUES ('TL02_01',N'BÚT BI ĐỎ THIÊN LONG','TL02',3000,N'BÚT BI','14/06/2019','14/06/2021','THIÊN LONG')
INSERT INTO VANPHONGPHAM (MASANPHAM, TENSANPHAM, MALOAISANPHAM, GIA, DANHMUC, NGAYSANXUAT, HANSUDUNG, NHASANXUAT) VALUES ('GELTL01_01',N'BÚT GEL XANH THIÊN LONG','GELTL01',10000,N'BÚT GEL','21/12/2019','21/12/2021','THIÊN LONG')
INSERT INTO VANPHONGPHAM (MASANPHAM, TENSANPHAM, MALOAISANPHAM, GIA, DANHMUC, NGAYSANXUAT, HANSUDUNG, NHASANXUAT) VALUES ('PENTEL01_01',N'TẨY PENTEL','PENTEL01',8000,N'TẨY','22/04/2018','22/04/2021','PENTEL')
INSERT INTO VANPHONGPHAM (MASANPHAM, TENSANPHAM, MALOAISANPHAM, GIA, DANHMUC, NGAYSANXUAT, NHASANXUAT) VALUES ('BLTL01_01',N'BÌA LÁ THIÊN LONG','BLTL01',15000,N'BÌA LÁ','22/05/2018','THIÊN LONG')
GO
DELETE FROM VANPHONGPHAM WHERE MASANPHAM = 'TL01_01'
CREATE TABLE KHOVANPHONGPHAM -- Table quản lý thông tin hàng hoá trong kho văn phòng phẩm
(
	MALOAISANPHAM VARCHAR(20) PRIMARY KEY,
	SOLUONGMOI INT,
	SOLUONGTONKHO INT
)
SELECT * FROM VANPHONGPHAM
DELETE FROM VANPHONGPHAM WHERE MALOAISANPHAM = 'TL02'
DROP TABLE KHOVANPHONGPHAM
ALTER TABLE KHOVANPHONGPHAM DROP COLUMN SOLUONGMOI
--DATA CHO BẢNG KHO VĂN PHÒNG PHẨM
INSERT INTO KHOVANPHONGPHAM (MALOAISANPHAM,SOLUONGMOI,SOLUONGTONKHO) VALUES ('TL01',100,50)
INSERT INTO KHOVANPHONGPHAM (MALOAISANPHAM,SOLUONGMOI,SOLUONGTONKHO) VALUES ('TL02',100,50)
INSERT INTO KHOVANPHONGPHAM (MALOAISANPHAM,SOLUONGMOI,SOLUONGTONKHO) VALUES ('GELTL01',100,50)
INSERT INTO KHOVANPHONGPHAM (MALOAISANPHAM,SOLUONGMOI,SOLUONGTONKHO) VALUES ('PENTEL01',100,50)
INSERT INTO KHOVANPHONGPHAM (MALOAISANPHAM,SOLUONGMOI,SOLUONGTONKHO) VALUES ('BLTL01',100,50)
SELECT * FROM KHOVANPHONGPHAM
DELETE KHOVANPHONGPHAM WHERE MALOAISANPHAM = 'TL01'
ALTER TABLE KHOVANPHONGPHAM  /* KHÓA CHÍNH CHO BẢNG KHO VĂN PHÒNG PHẨM */
ADD CONSTRAINT KHOVANPHONGPHAM_PK PRIMARY KEY (MALOAISANPHAM)
ALTER TABLE KHOVANPHONGPHAM
ADD CONSTRAINT fk_vanphongpham FOREIGN KEY ( MASANPHAM) REFERENCES VANPHONGPHAM (MASANPHAM)
GO
CREATE TABLE HOADONVPP
(MAHOADON VARCHAR(50) PRIMARY KEY,
MALOAISANPHAM VARCHAR(20)
SOLUONGMOI INT,
NGAYNHAP DATE NOT NULL,
MALOHANG NVARCHAR(20),
NHACUNGCAP NVARCHAR(50)
)
ALTER TABLE HOADONVPP ADD CONSTRAINT FK_MALOAISANPHAM_KHOVANPHONGPHAM FOREIGN KEY (MALOAISANPHAM) REFERENCES KHOVANPHONGPHAM (MALOAISANPHAM)
INSERT INTO HOADONVPP (MAHOADON, MALOAISANPHAM, SOLUONGMOI, NGAYNHAP, MALOHANG, NHACUNGCAP) VALUES ('HD01','GELTL01','100','24/05/2018','IMPORT01',N'THIÊN LONG')
SELECT * FROM HOADONVPP
alter table KHOSACH
ADD CONSTRAINT FK_KHOSACH_SACH FOREIGN KEY (MASACH) REFERENCES SACH(MASACH)
---Thêm các ràng buộc cho bảng SACH---
alter table SACH add constraint dfLanTaiBan default(0) for LANTAIBAN
alter table SACH add constraint checkGia check (GIA>0)
alter table SACH add constraint dfTheLoai default('Khong xac dinh') for THELOAI

---Thêm các ràng buộc cho bảng KHOSACH---
alter table KHOSACH add constraint checkSoLuong check (SOLUONGTONKHO>=0)
alter table KHOSACH add constraint dfNGAYNHAP default('1/1/2019') for NGAYNHAP --Ngày mở nhà sách
SELECT *
FROM KHOVANPHONGPHAM INNER JOIN HOADONVPP
ON KHOVANPHONGPHAM.MALOAISANPHAM =HOADONVPP.MALOAISANPHAM
select * from SACH
delete hoadonvpp where MALOAISANPHAM = 'tl01'
CREATE TABLE HOADONXUAT
(
MAHOADON VARCHAR(20) NOT NULL PRIMARY KEY,
THANHTIEN MONEY NOT NULL,
TIENTHUA MONEY NOT NULL,
NGAYLAPHOD DATETIME NOT NULL
)
CREATE TABLE CTHD
(
MAHOADON VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES HOADONXUAT(MAHOADON),
MASACH VARCHAR(50) NOT NULL FOREIGN KEY REFERENCES SACH (MASACH),
)
ALTER TABLE CTHD ADD PRIMARY KEY (MAHOADON, MASACH)